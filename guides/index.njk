{% extends "layout.njk" %}

{% block head %}
  <title>Guides | Blake Porter</title>
  <meta name="description" content="Browse all travel guides by region, country, subregion, and city.">
{% endblock %}

{% block content %}
  <div class="guides-page container">
    <h1>Guides</h1>
    <div class="guides-layout">

      <!-- Filters Section -->
      <aside class="filters">
        <h2>Filter Guides</h2>
        {% for region, countries in guidesByRegion %}
          <div class="filter-group">
            <h3>{{ region }}</h3>
            {% if region == query.region %}
              {% for country, subs in countries %}
                <div class="subfilter-group">
                  <strong>{{ country }}</strong>
                  {% if country == query.country %}
                    <ul>
                      {% for sub, cities in subs %}
                        <li>
                          <a href="/guides/?region={{ region | url_encode }}&country={{ country | url_encode }}&subregion={{ sub | url_encode }}" class="filter-btn">{{ sub }}</a>
                          {% if sub == query.subregion %}
                            <ul>
                              {% for city in cities %}
                                <li>
                                  <a href="/guides/?region={{ region | url_encode }}&country={{ country | url_encode }}&subregion={{ sub | url_encode }}&city={{ city | url_encode }}" class="filter-btn">{{ city }}</a>
                                </li>
                              {% endfor %}
                            </ul>
                          {% endif %}
                        </li>
                      {% endfor %}
                    </ul>
                  {% endif %}
                </div>
              {% endfor %}
            {% else %}
              <a href="/guides/?region={{ region | url_encode }}" class="filter-btn">View {{ region }}</a>
            {% endif %}
          </div>
        {% endfor %}
      </aside>

      <!-- Guides List Section -->
      <div class="guides-list">
        {% if collections.guides | length %}
          {% for guide in collections.guides %}
            <article class="guide-card">
              <a href="/{{ guide.data.slug }}/">
                <h2>{{ guide.data.title }}</h2>
                <p>{{ guide.data.excerpt }}</p>
              </a>
            </article>
          {% endfor %}
        {% else %}
          <p>No guides match this filter.</p>
        {% endif %}
      </div>

    </div>
  </div>
{% endblock %}
