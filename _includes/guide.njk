{% extends "layout.njk" %}

{% block head %}
  <title>{{ metaTitle or title }} | Blake Porter</title>
  <meta name="description" content="{{ description }}">
  <meta name="keywords" content="{{ keywords }}">
  {% if robots %}<meta name="robots" content="{{ robots }}">{% endif %}
  <meta property="og:title" content="{{ title }}">
  <meta property="og:description" content="{{ description }}">
  <meta property="og:image" content="{{ site.url }}{{ socialImage or bannerImage }}">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ title }}">
  <meta name="twitter:description" content="{{ description }}">
  <meta name="twitter:image" content="{{ site.url }}{{ socialImage or bannerImage }}">
{% endblock %}

{% block body %}
  <article class="guide-article container">
    <header class="guide-header">
      <h1>{{ title }}</h1>
      {% if readTime %}<p class="read-time">{{ readTime }}</p>{% endif %}
      <p class="author-date">By {{ author }} on {{ date }}</p>
      {% if updated %}<p class="updated-date">Updated {{ updated }}</p>{% endif %}
      {% if bannerImage %}
      <figure class="banner">
        {% responsiveImage bannerImage, bannerAlt, "100vw" %}
      </figure>
      {% endif %}
    </header>

    <section class="quick-facts">
      <h2>Quick Facts</h2>
      <ul>
        {% if region %}<li><strong>Region:</strong> {{ region }}</li>{% endif %}
        {% if country %}<li><strong>Country:</strong> {{ country }}</li>{% endif %}
        {% if subregion %}<li><strong>Subregion:</strong> {{ subregion }}</li>{% endif %}
        {% if city %}<li><strong>City:</strong> {{ city }}</li>{% endif %}
        {% if area %}<li><strong>Area:</strong> {{ area }}</li>{% endif %}
        {% if estimatedCostYen %}<li><strong>Estimated Cost:</strong> Â¥{{ estimatedCostYen }} JPY</li>{% endif %}
        {% if mapLink %}<li><strong>Map:</strong> <a href="{{ mapLink }}" target="_blank">View on Google Maps</a></li>{% endif %}
      </ul>
    </section>

    <section class="content">
      {{ content | safe }}
    </section>

    {% if mapEmbed %}
    <section class="map-embed">
      <h2>Location Map</h2>
      <iframe src="{{ mapEmbed }}" width="100%" height="450" loading="lazy"></iframe>
    </section>
    {% endif %}

  </article>
{% endblock %}

{% block filters %}
  <aside class="filters">
    <h2>Filter Guides</h2>
    {% set hierarchy = ["region","country","subregion","city","area"] %}
    {% for level in hierarchy %}
      {% set values = collections.guides | map(attribute="data." ~ level) | unique | reject("equalto","") %}
      {% if values | length %}
      <div class="filter-group">
        <label>{{ level | capitalize }}</label>
        {% for v in values %}
          <a href="/guides/?{{ level }}={{ v }}" class="filter-btn">{{ v }}</a>
        {% endfor %}
      </div>
      {% endif %}
    {% endfor %}
  </aside>
{% endblock %}